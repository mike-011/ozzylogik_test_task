# Ozzylogik Test Task

## Описание проекта

Это тестовое задание на позицию системного администратора. В проекте автоматизируется создание и настройка двух виртуальных машин с помощью Ansible и QEMU/KVM:
- ubu1: сервер с установленным LEMP-стеком.
- ubu2: сервер с ELK-стеком для мониторинга логов с ubu1.

Проект использует Filebeat для отправки логов Nginx с ubu1 на сервер с ELK-стеком (ubu2), где данные обрабатываются и отображаются через Kibana.

## Требования

Для работы проекта необходимы:
- QEMU/KVM: для управления виртуальными машинами.
- Ansible: для автоматизации развертывания и настройки серверов.
- Filebeat: для сбора и отправки логов.
- ELK Stack: для обработки и визуализации логов (Elasticsearch, Logstash, Kibana).

## Установка и запуск

### 1. Подготовка виртуальных машин
Для создания виртуальных машин используйте скрипт:
```
bash
./vm-up.sh
```
- Для доступа к виртуальным машинам через консоль можно использовать команду `virsh console <vm-name>`
- Для графического подключения — использовать `virt-manager`
- Если настроена сеть, можно получить доступ через `SSH`, узнав IP-адрес с помощью `virsh domifaddr <vm-name> --source agent `.

##### задайте параметрый виртуальных машин тут:`./vm-up.sh`
*(!) для ELK требуется очень много оперативной память*



### Этот скрипт создаёт две машины:

- `ubu1` с LEMP-стеком.
- `ubu2` с ELK-стеком.
- создает inventory файл с группами и ip адресами 


### 2. Настройка серверов через Ansible

После создания виртуальных машин, настройте их с помощью Ansible плейбука:
`ansible-playbook -i ansible/inventories/hosts pb/infra-as-code.yml`
##### читайте внимательно ответы Ansible, там юудет вся информация

### 3. Удаление виртуальных машин

Чтобы удалить созданные виртуальные машины, выполните команду:

`./del-vm.sh`

## Конфигурации

#### LEMP-стек (ubu1)

- Установлен Nginx, PHP, MySQL.
- Filebeat настроен на сбор логов Nginx и отправку их на сервер ELK (ubu2).

#### ELK-стек (ubu2)

- Logstash принимает логи от Filebeat с ubu1 через порт 5044.
- Elasticsearch индексирует логи.
- Kibana отображает данные через дашборд.


## Проверка

- Проверка состояния виртуальных машин:
`virsh list --all`

- Проверка логов Filebeat на ubu1:
`sudo tail -f /var/log/filebeat/filebeat.log`

- Проверка логов Logstash на ubu2:
`sudo journalctl -u logstash`

